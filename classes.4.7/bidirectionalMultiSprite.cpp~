#include "cocos2d.h"
#include "bidirectionalMultiSprite.h"
#include "iostream"
#include <cmath>

void BidirectionalMultiSprite::update(float dt){
  MultiSprite::update(dt);
  
  //dot product of x and y / (magnitude(x)*magnitude(y)) gives degrees for rotation
  int angle = static_cast<int>(CC_RADIANS_TO_DEGREES(getVelocity().getAngle()));
  //int absAngle = std::abs(angle);
  std::cout << "(" << dx() << "," << dy() << ")" << std::endl;
  
  
  /*if(absAngle == 90){ //moving vertical
    std::cout << "moving vertical";
  }else if(absAngle > 90){ //moving left
    std::cout << "moving left";
    if(angle == 0){
    
    }else if(angle < 0
  
  }else{ //moving right
    std::cout << "moving right";
  
  }*/
  
  if(angle == 90 || angle == -90){ //moving vertical
    //std::cout << "moving vertical";
  }else if(angle > 0 && angle < 90){ //moving up and right
    sprite->setFlippedX(true);
    sprite->setRotation(-angle);
  }else if(angle > 90 && angle < 180){ //moving up and left
    sprite->setFlippedX(false);
    sprite->setRotation(180-angle);
  }else if(angle < 0 && angle > -90){ //moving down and right
    sprite->setFlippedX(true);
    sprite->setRotation(-angle);
  }else if(angle < -90 && angle > -180){  //moving down and left
    sprite->setFlippedX(false);
    sprite->setRotation(-(180+angle));
  }else if(angle == -180 || angle == 180){
    sprite->setFlippedX(false);
    sprite->setRotation(0);
  }else if(angle == 0){
    sprite->setFlippedX(true);
    sprite->setRotation(0);
  }
  
  //std::cout << angle <<std::endl;
  /*
  if(getName() == "redBird"){
    std::cout << dx();
  }
  int xVel = static_cast<int>(dx()+.000001);
  if(xVel == 0){
    std::cout << " dx is zero!";
    
    if(dy() > 0){
      angle = 90;
    }else{
      angle = -90;
    }
    if(sprite->isFlippedX()){
      angle += -1;
    }
    sprite->setRotation(-90);
  }else if(xVel < 0){
    sprite->setFlippedX(false);
    sprite->setRotation(angle%90);
  }else{
    sprite->setFlippedX(true);
    angle *= -1;
    sprite->setRotation(angle%90);
  }*/
  //if(getName() == "redBird") std::cout << " angle is " << angle << std::endl;
  //if(angle > 0){
  //sprite->setRotation(angle % 180);
  //if(getName() == "redBird") std::cout << ", rotated " << angle%90 << " degrees from the positive x axis." << std::endl;
  
  //}else{
  //  sprite->setRotation(0);
 // }
  
}
